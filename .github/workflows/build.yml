name: Build Jekyll Site

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-24.04-x64  # adjust this to your self-hosted runner label if needed
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # Optionally install rbenv and ruby-build if they are not already available.
      - name: Install rbenv and ruby-build (if needed)
        run: |
          if ! command -v ruby-build >/dev/null; then
            git clone https://github.com/rbenv/rbenv.git ~/.rbenv
            cd ~/.rbenv && src/configure && make -C src
            git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
            export PATH="$HOME/.rbenv/bin:$PATH"
            eval "$(rbenv init -)"
          fi

      - name: Install Ruby 3.1.4 using ruby-build
        run: |
          RUBY_DIR="/opt/hostedtoolcache/Ruby/3.1.4/x64"
          if [ ! -f "${RUBY_DIR}.complete" ]; then
            sudo mkdir -p "$RUBY_DIR"
            sudo chown $USER "$RUBY_DIR"
            ruby-build 3.1.4 "$RUBY_DIR"
            touch "${RUBY_DIR}.complete"
          fi

      - name: Update PATH with Ruby
        run: echo "/opt/hostedtoolcache/Ruby/3.1.4/x64/bin" >> $GITHUB_PATH

      - name: Install Dependencies
        run: bundle install

      - name: Build Site
        run: bundle exec jekyll build
